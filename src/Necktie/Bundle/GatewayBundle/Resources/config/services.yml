
services:

    gw.logger:
        class: Necktie\Bundle\GatewayBundle\Logger\Logger
        arguments:
          - "@doctrine.orm.entity_manager"


    gw.client_factory:
        class: Necktie\Bundle\GatewayBundle\Gateway\ClientFactory


    gw.api:
      class: Necktie\Bundle\GatewayBundle\Gateway\ApiGateway
      arguments:
          - "@gw.client_factory"


    gw.consumer:
          class: Necktie\Bundle\GatewayBundle\Consumer\GatewayConsumer
          arguments:
            - "@gw.proxy.consumer"


    gw.producer:
          class: Necktie\Bundle\GatewayBundle\Producer\NecktieProducer


    ### proxy
    gw.proxy.producer:
        class: Necktie\Bundle\GatewayBundle\Proxy\ProducerProxy
        arguments:
          - "@kernel"


    gw.proxy.consumer:
        class: Necktie\Bundle\GatewayBundle\Proxy\ConsumerProxy
        arguments:
          - "@event_dispatcher"


    gw.message.logger:
      class: Necktie\Bundle\GatewayBundle\Message\MessagesLogger
      arguments:
        - "@doctrine.orm.entity_manager"


    gw.message.processor:
        class:  Necktie\Bundle\GatewayBundle\Message\MessageProcessor
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@gw.api"
            - "@gw.logger"
            - "@gw.proxy.producer"
        calls:
            - [ addProcessor, ['@gw.processor.http'] ]
            - [ addProcessor, ['@gw.processor.aweber'] ]


    gw.message.listener:
        class: Necktie\Bundle\GatewayBundle\EventListener\MessagesListener
        arguments:
          - "@gw.message.logger"
          - "@gw.message.processor"
        tags:
            - { name: kernel.event_listener, event: message.consume, priority: 10 }


    gw.processor.http:
      class: Necktie\Bundle\GatewayBundle\Gateway\RequestProcessor\HTTPProcessor
      arguments:
        - "@gw.api"
        - "@gw.logger"


    gw.processor.aweber:
      class: Necktie\Bundle\GatewayBundle\Gateway\RequestProcessor\AWeberProcessor
      arguments:
        - "@gw.logger"


